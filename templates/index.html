<!doctype html>
<html lang="en" data-bs-theme="light">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ADV Project</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  </head>
  <body>
    <!-- Theme Toggle Button -->
    <button id="theme-toggle" class="btn position-fixed top-0 end-0 m-3 p-2 border-0 rounded-3" style="background-color: #6E2CF3;" onclick="toggleTheme()">
        <span id="icon-light" style="display: inline; color: white;">
            <!-- Sun Icon for Light Mode -->
            <svg class="" id='Sun_24' width='25' height='25' viewBox='0 0 25 25' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><rect width='25' height='25' stroke='none' fill='#000000' opacity='0'/>
                <g transform="matrix(0.71 0 0 0.71 12 12)" >
                    <path style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(255, 255, 255); fill-rule: nonzero; opacity: 1;" transform=" translate(-15, -15)" d="M 14.984375 0.98632812 C 14.432858850921447 0.9949491932269869 13.992447346692762 1.4484681849375836 14 2 L 14 5 C 13.994899710454515 5.360635916577569 14.184375296169332 5.696081364571607 14.495872849714331 5.877887721486517 C 14.80737040325933 6.059694078401428 15.192629596740671 6.059694078401427 15.504127150285669 5.877887721486517 C 15.815624703830668 5.696081364571606 16.005100289545485 5.360635916577569 16 5 L 16 2 C 16.003701428278323 1.7296996878410038 15.897823277571275 1.4694133980471826 15.706490289327581 1.278448356915857 C 15.515157301083889 1.0874833157845312 15.254667686426398 0.9821063918050874 14.984375 0.9863281199999998 z M 5.796875 4.7988281 C 5.390307571779841 4.799727813058857 5.024747724109918 5.0466658724711 4.872127266987127 5.42350122012412 C 4.7195068098643365 5.800336567777141 4.810204311286739 6.232061446201437 5.1015625 6.515625 L 7.2226562 8.6367188 C 7.4734747742894845 8.897950774627645 7.845920925680961 9.003178817783573 8.196357534454025 8.911820813163818 C 8.546794143227087 8.820462808544063 8.820462808544063 8.546794143227087 8.911820813163818 8.196357534454025 C 9.003178817783573 7.845920925680962 8.897950774627645 7.4734747742894845 8.6367188 7.2226562 L 6.515625 5.1015625 C 6.326881584505291 4.907543242297413 6.067554306024078 4.798315711090954 5.796874999999999 4.7988281 z M 24.171875 4.7988281 C 23.91207637618049 4.806569235874743 23.665496604386604 4.915148405716428 23.484375 5.1015625 L 21.363281 7.2226562 C 21.102052002904948 7.473475478687656 20.996826279627488 7.845920221407292 21.0881847275989 8.196354999174766 C 21.179543175570313 8.546789776942237 21.45321047503226 8.820456998991142 21.803645278642545 8.911815347834061 C 22.15408008225283 9.00317369667698 22.52652479520695 8.897947868045012 22.777344 8.6367188 L 24.898438 6.515625 C 25.194198611196686 6.228133531782297 25.283126982508392 5.78855867769059 25.122372540615846 5.408711744248679 C 24.9616180987233 5.028864810806767 24.58415869478189 4.7866692163999005 24.171875 4.7988281 z M 15 8 C 11.134006751184446 8 8 11.134006751184446 8 15 C 8 18.865993248815556 11.134006751184446 22 15 22 C 18.865993248815556 22 22 18.865993248815556 22 15 C 22 11.134006751184446 18.865993248815556 8 15 8 z M 2 14 C 1.6393640834224308 13.994899710454515 1.303918635428393 14.184375296169332 1.122112278513483 14.495872849714331 C 0.9403059215985725 14.80737040325933 0.9403059215985727 15.192629596740671 1.1221122785134834 15.50412715028567 C 1.3039186354283938 15.815624703830668 1.6393640834224317 16.005100289545485 2.000000000000001 16 L 5 16 C 5.360635916577569 16.005100289545485 5.696081364571606 15.815624703830668 5.877887721486517 15.504127150285669 C 6.059694078401427 15.192629596740671 6.059694078401427 14.80737040325933 5.877887721486517 14.495872849714331 C 5.696081364571607 14.184375296169332 5.36063591657757 13.994899710454515 5 14 L 2 14 z M 25 14 C 24.639364083422432 13.994899710454515 24.303918635428392 14.184375296169332 24.122112278513484 14.495872849714331 C 23.940305921598572 14.80737040325933 23.940305921598572 15.192629596740671 24.122112278513484 15.50412715028567 C 24.303918635428396 15.815624703830668 24.639364083422432 16.005100289545485 25 16 L 28 16 C 28.360635916577568 16.005100289545485 28.696081364571608 15.815624703830668 28.877887721486516 15.504127150285669 C 29.059694078401428 15.192629596740671 29.059694078401428 14.80737040325933 28.877887721486516 14.495872849714331 C 28.696081364571608 14.184375296169332 28.360635916577568 13.994899710454515 28 14 L 25 14 z M 7.9101562 21.060547 C 7.650357633234646 21.06828803006726 7.403777869504378 21.176867052893616 7.2226562 21.363281 L 5.1015625 23.484375 C 4.840332687478055 23.735194028674634 4.735106278805363 24.10763909384306 4.826464516798396 24.458074355262834 C 4.917822754791428 24.80850961668261 5.191490318348736 25.08217727700635 5.54192554746503 25.173535638910163 C 5.892360776581324 25.264894000813978 6.264805878956845 25.159667723834552 6.515625 24.898438 L 8.6367188 22.777344 C 8.932479425659293 22.489852592784644 9.021407865729074 22.050277793495432 8.860653519365592 21.670430854534104 C 8.69989917300211 21.29058391557277 8.322439866374033 21.048388243722005 7.910156199999999 21.060547 z M 22.060547 21.060547 C 21.653623751211732 21.060653620792113 21.287337545573887 21.3073021613425 21.13421542352209 21.684316958811703 C 20.981093301470292 22.061331756280904 21.071669465536033 22.493531994017236 21.363281 22.777344 L 23.484375 24.898438 C 23.7351949093915 25.159664089509963 24.107638213177474 25.26488759750432 24.45807118516122 25.173528805182695 C 24.80850415714497 25.082170012861067 25.082170012861067 24.80850415714497 25.173528805182695 24.45807118516122 C 25.26488759750432 24.107638213177474 25.159664089509963 23.7351949093915 24.898438 23.484375 L 22.777344 21.363281 C 22.589072813353702 21.169748354142616 22.33054871201499 21.060562580074542 22.060547 21.060547 z M 14.984375 23.986328 C 14.43285880343316 23.994949073062962 13.992447279873389 24.448468138368238 14 25 L 14 28 C 13.994899710454515 28.360635916577568 14.184375296169332 28.696081364571608 14.495872849714331 28.877887721486516 C 14.80737040325933 29.059694078401428 15.192629596740671 29.059694078401428 15.504127150285669 28.877887721486516 C 15.815624703830668 28.696081364571608 16.005100289545485 28.360635916577568 16 28 L 16 25 C 16.0037014610102 24.729699667173673 15.89782332475401 24.46941334607979 15.706490332869745 24.27844827870817 C 15.51515734098548 24.087483211336544 15.254667707530459 23.98210627103109 14.984375 23.986328 z" stroke-linecap="round" />
                </g>
            </svg>
        </span>
        <span id="icon-dark" style="display: none;">
            <!-- Moon Icon for Dark Mode -->
            <svg id='Moon_and_Stars_24' width='26' height='26' viewBox='0 0 26 26' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><rect width='26' height='26' stroke='none' fill='#000000' opacity='0'/>
                <g transform="matrix(0.95 0 0 0.95 12 12)" >
                    <path style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(255, 255, 255); fill-rule: nonzero; opacity: 1;" transform=" translate(-11.5, -12)" d="M 4 3 L 3.187 5.188 L 1 6 L 3.187 6.813 L 4 9 L 4.812 6.813 L 7 6 L 4.812 5.188 z M 22 12.92 C 22.02 14.99 21.24 17.07 19.66 18.66 C 16.53 21.78 11.47 21.78 8.34 18.66 C 5.22 15.530000000000001 5.22 10.47 8.34 7.34 C 9.93 5.76 12.01 4.98 14.08 5 C 13.77 7.109999999999999 14.43 9.33 16.05 10.95 C 17.67 12.57 19.89 13.23 22 12.92 z" stroke-linecap="round" />
                </g>
            </svg>
        </span>
    </button>

    <!-- Spinner overlay with Bootstrap utility classes -->
    <div id="spinner" class="position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center d-none" style="background-color: rgba(0, 0, 0, 0.5); z-index: 1050;">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
  
    <!-- Main Content -->
    <div class="container mt-5">
        <!-- Page Header -->
        <h1 class="text-center mb-4">Querify</h1>

        <!-- Response Section -->
        <div id="response" class="alert alert-info" role="alert" style="display: none;"></div>

        <!-- Upload Section -->
        <div class="card mb-4">
            <div class="card-header">
                <h3 class="mb-0 p-2">Upload Your Dataset</h3>
            </div>
            <div class="card-body">
                <form id="upload-form" action="/upload" method="post" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="fileInput" class="form-label">Upload File</label>
                        <input type="file" name="file" class="form-control" id="fileInput" required>
                    </div>                    
                    <button type="submit" class="btn btn-primary">Upload</button>
                </form>
            </div>
        </div>

        <!-- Query Section -->
        <div class="card mb-4">
            <div class="card-header">
                <h3 class="mb-0 p-2">Enter Your Query</h3>
            </div>
            <div class="card-body">
                <form id="query-form" action="/query" method="post">
                    <div class="form-group mb-3">
                        <input type="text" name="query" class="form-control" placeholder="Enter your query" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        function toggleTheme() {
            const html = document.documentElement;
            const iconLight = document.getElementById("icon-light");
            const iconDark = document.getElementById("icon-dark");
            const currentTheme = html.getAttribute("data-bs-theme");
            const newTheme = currentTheme === "dark" ? "light" : "dark";
            
            html.setAttribute("data-bs-theme", newTheme);
            if (newTheme === "dark") {
                iconLight.style.display = "none";
                iconDark.style.display = "inline";
            } else {
                iconLight.style.display = "inline";
                iconDark.style.display = "none";
            }
        }

        const uploadForm = document.getElementById('upload-form');
        const queryForm = document.getElementById('query-form');
        const responseDiv = document.getElementById('response');
        
        // Event listeners for form submission
        uploadForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(uploadForm);
            const response = await fetch(uploadForm.action, {
                method: uploadForm.method,
                body: formData,
            });
            const data = await response.json();
            responseDiv.style.display = "block";
            if (response.ok) {
                responseDiv.className = "alert alert-success";
                responseDiv.textContent = data.message || "File uploaded successfully.";
                tempFilePath = data.temp_file;
            } else {
                responseDiv.className = "alert alert-danger";
                responseDiv.textContent = data.error;
            }
            uploadForm.reset();
            setTimeout(() => {
                responseDiv.style.display = "none";
            }, 5000);
        });

        queryForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const queryText = queryForm.query.value;

            // Show spinner
            const spinner = document.getElementById('spinner');
            spinner.classList.toggle("d-none");

            const response = await fetch(queryForm.action, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    query: queryText,
                    temp_file: tempFilePath
                })
            });
            const data = await response.json();

            // Hide spinner
            spinner.classList.toggle("d-none");
            
            responseDiv.style.display = "block";
            if (response.ok) {
                responseDiv.className = "alert alert-success";
                responseDiv.textContent = data.message || "Query submitted successfully.";
            } else {
                responseDiv.className = "alert alert-danger";
                responseDiv.textContent = data.error;
            }
            queryForm.reset();
            setTimeout(() => {
                responseDiv.style.display = "none";
            }, 5000);
        });
    </script>
  </body>
</html>
